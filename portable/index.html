<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech Support Bro</title>
    <link rel="stylesheet" href="./styles.css">
    <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
</head>
<body>
    <main class="layout">
        <section class="hero hero-shell">
            <div class="hero-content">
                <img src="./techsupportbrologo.png" alt="Tech Support Bro" class="hero-logo">
                <div class="hero-actions">
                    <button id="startTree" class="primary">Start troubleshooting</button>
                    <a class="secondary" href="https://docs.google.com/forms/d/e/1FAIpQLSfoxhKvog1UU0YnpnK1U1toIyQkNborx3IAVtJOpc-5VwKhAg/viewform?usp=dialog" target="_blank" rel="noopener">
                        Escalate to Garin
                    </a>
                </div>
            </div>
            <div class="hero-visual">
                <div class="grid-lines"></div>
                <div class="tablet-stage" id="tabletStage">
                    <div class="tablet-shadow"></div>
                    <div class="tablet" id="tabletModel">
                        <div class="tablet-face"></div>
                        <div class="tablet-back">
                            <img class="tablet-back-logo" draggable="false" src="./techsupportbrologo.png" alt="Tech Support Bro logo">
                        </div>
                        <div class="tablet-screen">
                            <video autoplay muted loop playsinline>
                                <source src="./ITChatBuddyAvatar.mp4" type="video/mp4">
                                <source src="./ITChatBuddyAvatar.mov" type="video/quicktime">
                                Your browser does not support inline video playback.
                            </video>
                            <h2 class="tablet-title">Tech Support Bro</h2>
                            <span class="tablet-caption">"What can I fix for you today?"</span>
                            <div class="tablet-screen-indicator"></div>
                        </div>
                    </div>
                    <div class="floating-badges">
                        <div class="floating-badge">Fix my home Wi-Fi</div>
                        <div class="floating-badge">Speed up my laptop</div>
                        <div class="floating-badge">Reset forgotten passwords</div>
                    </div>
                    <div class="tablet-interactive-hint">Tap or click the tablet to interact</div>
                </div>
            </div>
        </section>

        <section class="tree-card utilities-section">
    <div class="tree-header">
        <div>
            <p class="node-path">Utilities hub</p>
            <h2>Quick office tools</h2>
            <p class="node-summary">Open a tool to get fast, guided actions. Start troubleshooting remains below.</p>
        </div>
    </div>
    <div class="utilities-grid">
                <div class="utility-card">
                    <h3>PDF mini-suite</h3>
            <p>Turn images or plain text into a PDF. Everything stays in your browser.</p>
            <button class="ghost" type="button" data-target="#tool-pdf" aria-label="Open PDF tool">Open</button>
        </div>
                <div class="utility-card">
                    <h3>Screenshots & images</h3>
            <p>Capture/annotate, resize, or compress images for sharing.</p>
            <button class="ghost" type="button" data-target="#tool-image" aria-label="Open image tool">Open</button>
        </div>
                <div class="utility-card">
                    <h3>Snippets & canned replies</h3>
            <p>Save quick text snippets and paste canned responses with one click.</p>
            <button class="ghost" type="button" data-target="#tool-snippets" aria-label="Open snippets tool">Open</button>
        </div>
                <div class="utility-card">
                    <h3>Short links + QR</h3>
            <p>Create short links with basic click counts and matching QR codes.</p>
            <button class="ghost" type="button" data-target="#tool-links" aria-label="Open link tool">Open</button>
        </div>
                <div class="utility-card">
                    <h3>Time zones & scheduling</h3>
            <p>Find overlap across time zones and draft a scheduler blurb.</p>
            <button class="ghost" type="button" data-target="#tool-time" aria-label="Open time zone tool">Open</button>
        </div>
                <div class="utility-card">
                    <h3>Email signatures</h3>
            <p>Draft a clean signature with role, phone, and linkscopy in one tap.</p>
            <button class="ghost" type="button" data-target="#tool-signature" aria-label="Open email signature tool">Open</button>
        </div>
                <div class="utility-card">
                    <h3>Wi-Fi/business QR</h3>
            <p>Create a QR for Wi-Fi (SSID/password) or a quick contact/URL badge.</p>
            <button class="ghost" type="button" data-target="#tool-qr" aria-label="Open QR tool">Open</button>
        </div>
                <div class="utility-card">
                    <h3>Secure notes</h3>
            <p>Encrypt/decrypt short notes locally in your browser.</p>
            <button class="ghost" type="button" data-target="#tool-secure" aria-label="Open secure notes tool">Open</button>
        </div>
                <div class="utility-card">
                    <h3>Image metadata scrub</h3>
            <p>Strip EXIF/metadata from images before sharing.</p>
            <button class="ghost" type="button" data-target="#tool-exif" aria-label="Open EXIF tool">Open</button>
        </div>
                <div class="utility-card">
                    <h3>Spell check helper</h3>
            <p>Use your browser spell-check with a clean canvas and quick copy.</p>
            <button class="ghost" type="button" data-target="#tool-spell" aria-label="Open spell tool">Open</button>
        </div>
                <div class="utility-card">
                    <h3>URL safety check</h3>
            <p>Lightweight, client-side heuristics to flag risky links.</p>
            <button class="ghost" type="button" data-target="#tool-url" aria-label="Open URL safety tool">Open</button>
        </div>
    </div>
</section><section class="tree-card utilities-section" id="utilities-panels">
    <div class="tree-header">
        <div>
            <p class="node-path">Tools</p>
            <h2>Swiss army toolset</h2>
            <p class="node-summary">Simple panels you can tap to get the job done. Copy/download as you go.</p>
        </div>
    </div>
    <div class="utilities-grid">
                <div class="utility-card" id="tool-pdf">
                    <h3>PDF mini-suite</h3>
            <p>Create a PDF from images or plain text right here in the browser.</p>
            <input id="pdfInput" type="file" accept="image/*,text/plain" multiple aria-label="Files to turn into PDF">
            <button class="ghost" type="button" id="pdfProcess">Create PDF</button>
            <div id="pdfOutput" class="node-summary"></div>
            <a id="pdfDownload" class="ghost" style="display:none; margin-top:6px;" download="converted.pdf">Download PDF</a>
        </div>
                <div class="utility-card" id="tool-image">
                    <h3>Screenshots & images</h3>
            <p>Drop an image to resize/compress. Annotate with your screenshot tool, then upload.</p>
            <input id="imageInput" type="file" accept="image/*" aria-label="Image file">
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <label style="font-size:0.9rem; color: var(--text-muted);">Max side (px): <input id="imageMax" type="number" value="1280" style="width:90px"></label>
                <label style="font-size:0.9rem; color: var(--text-muted);">Quality: <input id="imageQuality" type="number" min="0.1" max="1" step="0.1" value="0.8" style="width:70px"></label>
            </div>
            <button class="ghost" type="button" id="imageProcess">Compress / Resize</button>
            <div id="imageInfo" class="node-summary"></div>
            <a id="imageDownload" class="ghost" style="display:none; margin-top:6px;" download="compressed.jpg">Download image</a>
        </div>
                <div class="utility-card" id="tool-snippets">
                    <h3>Snippets & replies</h3>
            <p>Save a quick reply and copy it with one tap.</p>
            <textarea id="snippetInput" rows="3" placeholder="Type your canned reply..."></textarea>
            <button class="ghost" type="button" id="snippetCopy">Copy snippet</button>
        </div>
                <div class="utility-card" id="tool-links">
                    <h3>Short links + QR</h3>
            <p>Paste a URL, generate a short link + QR.</p>
            <input type="url" id="linkInput" placeholder="https://example.com" aria-label="Long URL">
            <button class="ghost" type="button" id="linkMake">Generate</button>
            <div id="linkOutput" class="node-summary"></div>
            <img id="qrImage" alt="QR code" style="display:none; width:120px; height:120px; border-radius: 10px; border:1px solid rgba(255,255,255,0.08);">
        </div>
                <div class="utility-card" id="tool-time">
                    <h3>Time zones</h3>
            <p>Pick two zones and see local time for each.</p>
            <input type="text" id="tzA" placeholder="e.g., America/New_York" aria-label="Time zone A">
            <input type="text" id="tzB" placeholder="e.g., Europe/London" aria-label="Time zone B">
            <div id="tzOutput" class="node-summary">Enter IANA zones to compare.</div>
        </div>
                <div class="utility-card" id="tool-signature">
                    <h3>Email signatures</h3>
            <p>Fill in your details and copy a tidy signature block.</p>
            <input type="text" id="sigName" placeholder="Name" aria-label="Name">
            <input type="text" id="sigTitle" placeholder="Title / Team" aria-label="Title">
            <input type="text" id="sigPhone" placeholder="Phone" aria-label="Phone">
            <input type="url" id="sigLink" placeholder="Link (optional)" aria-label="Link">
            <textarea id="sigPreview" rows="4" readonly placeholder="Signature preview will appear here"></textarea>
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button class="ghost" type="button" id="sigBuild">Build</button>
                <button class="ghost" type="button" id="sigCopy">Copy</button>
            </div>
        </div>
                <div class="utility-card" id="tool-qr">
                    <h3>Wi-Fi/business QR</h3>
            <p>Create QR codes for Wi-Fi access or a business URL.</p>
            <select id="qrMode" aria-label="QR mode">
                <option value="wifi">Wi-Fi</option>
                <option value="link">Business/URL</option>
            </select>
            <input type="text" id="qrSsid" placeholder="Wi-Fi SSID or Label" aria-label="SSID or label">
            <input type="text" id="qrPass" placeholder="Wi-Fi password (hidden)" aria-label="Wi-Fi password">
            <input type="url" id="qrUrl" placeholder="Business/URL" aria-label="URL" style="display:none;">
            <button class="ghost" type="button" id="qrMake">Generate QR</button>
            <img id="qrOut" alt="QR code" style="display:none; width:140px; height:140px; border-radius: 10px; border:1px solid rgba(255,255,255,0.08);">
        </div>
                <div class="utility-card" id="tool-secure">
                    <h3>Secure notes</h3>
            <p>Encrypt/decrypt a short note locally with a passphrase.</p>
            <textarea id="secPlain" rows="3" placeholder="Enter note"></textarea>
            <input type="password" id="secKey" placeholder="Passphrase">
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button class="ghost" type="button" id="secEncrypt">Encrypt</button>
                <button class="ghost" type="button" id="secDecrypt">Decrypt</button>
            </div>
            <textarea id="secCipher" rows="3" placeholder="Ciphertext/result appears here"></textarea>
        </div>
                <div class="utility-card" id="tool-exif">
                    <h3>Image metadata scrub</h3>
            <p>Remove EXIF/metadata by re-encoding the image locally.</p>
            <input id="exifInput" type="file" accept="image/*" aria-label="Image file">
            <button class="ghost" type="button" id="exifStrip">Strip metadata</button>
            <div id="exifInfo" class="node-summary"></div>
            <a id="exifDownload" class="ghost" style="display:none; margin-top:6px;" download="clean-image.jpg">Download cleaned image</a>
        </div>
                <div class="utility-card" id="tool-spell">
                    <h3>Spell check helper</h3>
            <p>Type or paste text; use browser spell-check and copy.</p>
            <textarea id="spellArea" rows="5" spellcheck="true" placeholder="Your text..."></textarea>
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button class="ghost" type="button" id="spellCopy">Copy text</button>
                <button class="ghost" type="button" id="spellClear">Clear</button>
            </div>
        </div>
                <div class="utility-card" id="tool-url">
                    <h3>URL safety check</h3>
            <p>Runs local checks for risky patterns (no data leaves your browser).</p>
            <input type="url" id="urlInput" placeholder="https://example.com" aria-label="URL to check">
            <button class="ghost" type="button" id="urlCheck">Check URL</button>
            <div id="urlResult" class="node-summary"></div>
        </div>
    </div>
</section>

        <section class="tree-card">
            <div class="tree-header">
                <div>
                    <p class="node-path">Start here</p>
                    <h2>How this tool works</h2>
                    <p class="node-summary">Tap "Start troubleshooting" first, then pick your category. Follow the branching steps, and use Back or Start over anytime.</p>
                </div>
            </div>
            <div class="node-body">
                <div class="node-response">
                    <strong>What to expect:</strong> click "Start troubleshooting," choose your device/issue, then follow clear step-by-step actions with official links. Use Back to adjust or Start over to reset. Nothing is stored or sent?everything runs in your browser.
                    <ul class="node-summary" style="margin-top: 10px; text-align: left;">
                        <li>[WiFi] toggles: Windows Start > Settings > Network & Internet > Wi-Fi; iOS Settings > Wi-Fi; Android quick settings pull-down.</li>
                        <li>[Gear] Settings opens device menus (Windows gear icon, iOS/Android Settings app).</li>
                        <li>[Power] Restart: hold power button, choose Restart (or Settings > System > Restart).</li>
                        <li>[Back] Use Back/Start over anytime to change direction.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="tree-card" id="treePanel">
            <div class="tree-header">
                <div>
                    <p class="node-path" id="nodePath">Start</p>
                    <h2 id="nodeTitle">Choose a Help Topic</h2>
                    <p class="node-summary" id="nodeSummary">Click "Start troubleshooting" to load the root of the decision tree.</p>
                </div>
                <div class="tree-controls">
                    <button class="ghost" id="backBtn" disabled>Back</button>
                    <button class="ghost" id="restartBtn" disabled>Start over</button>
                    <button class="ghost" id="copyPlanBtn" disabled>Copy plan</button>
                </div>
            </div>
            <div class="node-body">
                <div class="node-response" id="nodeResponse">
                    The offline instructions will appear here after you pick a branch.
                </div>
                <div class="node-tags" id="nodeTags"></div>
                <div class="node-links" id="nodeLinks"></div>
                <div class="node-children" id="nodeChildren"></div>
            </div>
        </section>

        <section class="vibe-section" id="affirmationExperience">
            <div class="vibe-copy">
                <p class="eyebrow">Mental reset</p>
                <h2>Virtual phone affirmations</h2>
                <p>
                    Sometimes the fix is to pause for sixty seconds and hear a kind voice. Scroll into this lab to
                    spin, tap, and read positive prompts before diving back into tough tickets.
                </p>
                <ul class="vibe-list">
                    <li>Live loop of encouraging affirmations curated for late-night tech support sessions.</li>
                    <li>Interactive 3D-inspired phone shell that reacts to your pointer drags.</li>
                    <li>Quick action button cycles to the next vibe whenever you need another boost.</li>
                </ul>
                <div class="vibe-actions">
                    <button type="button" class="ghost" id="affirmationNext">Inspire me again</button>
                    <span class="vibe-caption">Gently scroll past the troubleshooting menus to reach this tool anytime.</span>
                </div>
            </div>
            <div class="vibe-phone-column">
                <div class="vibe-phone-glow"></div>
                <div class="vibe-phone-stage" data-role="affirmation-stage">
                    <div class="vibe-phone-rig" data-role="affirmation-rig">
                        <div class="vibe-phone-shell">
                            <span class="phone-signal"></span>
                            <div class="vibe-phone-screen" id="affirmationScreen">
                                <span class="screen-inner-shadow" aria-hidden="true"></span>
                                <span class="screen-reflection" aria-hidden="true"></span>
                                <div class="screen-status">
                                <span id="affirmationTime">11:11</span>
                                <span class="signal-indicator" aria-label="Signal strength">
                                    <span class="signal-bar bar-1"></span>
                                    <span class="signal-bar bar-2"></span>
                                    <span class="signal-bar bar-3"></span>
                                    <span class="signal-bar bar-4"></span>
                                </span>
                            </div>
                                <div class="affirmation-tag speech-bubble bubble-tag bubble-layer-2" id="affirmationTag">Grounding</div>
                                <blockquote class="speech-bubble bubble-message bubble-layer-3" id="affirmationText">Your calm is contagious.</blockquote>
                                <p class="affirmation-meta speech-bubble bubble-meta bubble-layer-2" id="affirmationSource">- Message from 'G'</p>
                                <div class="affirmation-ticker bubble-ticker" id="affirmationTicker"></div>
                            </div>
                            <div class="phone-notch">
                                <span class="notch-speaker"></span>
                                <span class="notch-camera"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="privacy-note">
            Privacy: We don't collect personal data. This tool runs locally in your browser; no analytics or telemetry are sent.
        </section>

    </main>
    <script src="./app.js"></script>
    <script>
        (() => {
            // Always start at top; prevent scroll restoration
            if ('scrollRestoration' in history) history.scrollRestoration = 'manual';
            window.scrollTo({ top: 0, left: 0, behavior: 'auto' });

            const scrollButtons = document.querySelectorAll('[data-target]');
            scrollButtons.forEach((btn) => {
                btn.addEventListener('click', () => {
                    const target = document.querySelector(btn.getAttribute('data-target'));
                    if (target) {
                        target.classList.add('pulse');
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        setTimeout(() => target.classList.remove('pulse'), 650);
                    }
                });
            });

            const pdfInput = document.getElementById('pdfInput');
            const pdfProcess = document.getElementById('pdfProcess');
            const pdfOutput = document.getElementById('pdfOutput');
            const pdfDownload = document.getElementById('pdfDownload');
            const readFile = (file, mode = 'arraybuffer') =>
                new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onerror = () => reject(reader.error || new Error('Read failed'));
                    reader.onload = () => resolve(reader.result);
                    if (mode === 'text') reader.readAsText(file);
                    else if (mode === 'dataurl') reader.readAsDataURL(file);
                    else reader.readAsArrayBuffer(file);
                });

            pdfProcess?.addEventListener('click', async () => {
                if (!pdfOutput) return;
                if (!window.PDFLib) {
                    pdfOutput.textContent = 'PDF engine failed to load. Please retry.';
                    return;
                }
                const files = Array.from(pdfInput?.files || []);
                if (!files.length) {
                    pdfOutput.textContent = 'Choose one or more images or a .txt file to convert.';
                    if (pdfDownload) pdfDownload.style.display = 'none';
                    return;
                }
                const { PDFDocument, StandardFonts } = PDFLib;
                const pdfDoc = await PDFDocument.create();
                const font = await pdfDoc.embedFont(StandardFonts.Helvetica);
                let added = 0;
                let skipped = 0;

                for (const file of files) {
                    if (file.type.startsWith('image/')) {
                        try {
                            const bytes = new Uint8Array(await readFile(file, 'arraybuffer'));
                            const image = file.type.includes('png')
                                ? await pdfDoc.embedPng(bytes)
                                : await pdfDoc.embedJpg(bytes);
                            const { width, height } = image.scale(1);
                            const page = pdfDoc.addPage([width, height]);
                            page.drawImage(image, { x: 0, y: 0, width, height });
                            added++;
                        } catch (e) {
                            skipped++;
                        }
                    } else if (file.type === 'text/plain') {
                        const text = await readFile(file, 'text');
                        const wrapLine = (str) => {
                            const words = str.split(' ');
                            const lines = [];
                            let current = '';
                            const maxWidth = 500;
                            for (const word of words) {
                                const test = current ? `${current} ${word}` : word;
                                if (font.widthOfTextAtSize(test, 12) > maxWidth) {
                                    lines.push(current || word);
                                    current = word;
                                } else {
                                    current = test;
                                }
                            }
                            if (current) lines.push(current);
                            return lines;
                        };
                        const lines = text.split(/\r?\n/).flatMap((ln) => wrapLine(ln));
                        let page = pdfDoc.addPage([612, 792]);
                        const maxWidth = 500;
                        const lineHeight = 18;
                        let y = page.getHeight() - 60;
                        for (const ln of lines) {
                            if (y < 60) {
                                page = pdfDoc.addPage([612, 792]);
                                y = page.getHeight() - 60;
                            }
                            page.drawText(ln, { x: 50, y, size: 12, font, maxWidth });
                            y -= lineHeight;
                        }
                        added++;
                    } else {
                        skipped++;
                    }
                }

                if (!added) {
                    pdfOutput.textContent = 'No supported files were added. Use images or .txt files.';
                    if (pdfDownload) pdfDownload.style.display = 'none';
                    return;
                }

                const pdfBytes = await pdfDoc.save();
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                if (pdfDownload) {
                    pdfDownload.href = url;
                    pdfDownload.style.display = 'inline-flex';
                }
                pdfOutput.textContent = skipped
                    ? `Built a PDF with ${added} file(s). Skipped ${skipped} unsupported type(s).`
                    : `Built a PDF with ${added} file(s).`;
            });

            const snippetInput = document.getElementById('snippetInput');
            const snippetCopy = document.getElementById('snippetCopy');
            snippetCopy?.addEventListener('click', async () => {
                const text = snippetInput?.value || '';
                try {
                    await navigator.clipboard.writeText(text);
                    snippetCopy.textContent = 'Copied';
                    setTimeout(() => (snippetCopy.textContent = 'Copy snippet'), 1200);
                } catch (e) {
                    alert('Copy failed. You can copy manually:\n\n' + text);
                }
            });

            const pwdOutput = document.getElementById('pwdOutput');
            const pwdGen = document.getElementById('pwdGen');
            const pwdCopy = document.getElementById('pwdCopy');
            const makePwd = () => {
                const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz23456789!@#$%^&*';
                let out = '';
                for (let i = 0; i < 16; i++) out += chars[Math.floor(Math.random() * chars.length)];
                return out;
            };
            pwdGen?.addEventListener('click', () => {
                if (pwdOutput) pwdOutput.value = makePwd();
            });
            pwdCopy?.addEventListener('click', async () => {
                const text = pwdOutput?.value || '';
                try {
                    await navigator.clipboard.writeText(text);
                    pwdCopy.textContent = 'Copied';
                    setTimeout(() => (pwdCopy.textContent = 'Copy'), 1200);
                } catch (e) {
                    alert('Copy failed. You can copy manually:\n\n' + text);
                }
            });

            // Email signature builder
            const sigName = document.getElementById('sigName');
            const sigTitle = document.getElementById('sigTitle');
            const sigPhone = document.getElementById('sigPhone');
            const sigLink = document.getElementById('sigLink');
            const sigPreview = document.getElementById('sigPreview');
            const sigBuild = document.getElementById('sigBuild');
            const sigCopy = document.getElementById('sigCopy');
            const buildSig = () => {
                const name = (sigName?.value || '').trim();
                const title = (sigTitle?.value || '').trim();
                const phone = (sigPhone?.value || '').trim();
                const link = (sigLink?.value || '').trim();
                const parts = [];
                if (name) parts.push(name);
                if (title) parts.push(title);
                if (phone) parts.push(` ${phone}`);
                if (link) parts.push(link);
                const result = parts.join('\n');
                if (sigPreview) sigPreview.value = result || 'Add details to build your signature.';
                return result;
            };
            sigBuild?.addEventListener('click', buildSig);
            sigCopy?.addEventListener('click', async () => {
                const text = buildSig();
                try {
                    await navigator.clipboard.writeText(text);
                    sigCopy.textContent = 'Copied';
                    setTimeout(() => (sigCopy.textContent = 'Copy'), 1200);
                } catch (e) {
                    alert('Copy failed. You can copy manually:\n\n' + text);
                }
            });

            // Wi-Fi / business QR
            const qrMode = document.getElementById('qrMode');
            const qrSsid = document.getElementById('qrSsid');
            const qrPass = document.getElementById('qrPass');
            const qrUrl = document.getElementById('qrUrl');
            const qrMake = document.getElementById('qrMake');
            const qrOut = document.getElementById('qrOut');
            const toggleQrFields = () => {
                const mode = qrMode?.value || 'wifi';
                const showWifi = mode === 'wifi';
                if (qrPass) qrPass.style.display = showWifi ? 'block' : 'none';
                if (qrSsid) qrSsid.placeholder = showWifi ? 'Wi-Fi SSID or Label' : 'Label (optional)';
                if (qrUrl) qrUrl.style.display = showWifi ? 'none' : 'block';
            };
            qrMode?.addEventListener('change', toggleQrFields);
            toggleQrFields();
            qrMake?.addEventListener('click', () => {
                const mode = qrMode?.value || 'wifi';
                if (mode === 'wifi') {
                    const ssid = (qrSsid?.value || '').trim();
                    const pass = (qrPass?.value || '').trim();
                    if (!ssid) {
                        alert('Enter the Wi-Fi network name (SSID).');
                        return;
                    }
                    const payload = `WIFI:T:WPA;S:${ssid};P:${pass};H:false;`;
                    if (qrOut) {
                        qrOut.src = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(payload)}`;
                        qrOut.style.display = 'block';
                    }
                } else {
                    const url = (qrUrl?.value || '').trim();
                    if (!url) {
                        alert('Enter a URL to generate a QR.');
                        return;
                    }
                    if (qrOut) {
                        qrOut.src = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(url)}`;
                        qrOut.style.display = 'block';
                    }
                }
            });

            // Secure notes (AES-GCM in-browser)
            const secPlain = document.getElementById('secPlain');
            const secKey = document.getElementById('secKey');
            const secEncrypt = document.getElementById('secEncrypt');
            const secDecrypt = document.getElementById('secDecrypt');
            const secCipher = document.getElementById('secCipher');
            const textToBytes = (str) => new TextEncoder().encode(str);
            const bytesToBase64 = (bytes) => btoa(String.fromCharCode(...bytes));
            const base64ToBytes = (b64) => Uint8Array.from(atob(b64), (c) => c.charCodeAt(0));
            const deriveKey = async (pass) => {
                const enc = new TextEncoder();
                const keyMaterial = await crypto.subtle.importKey('raw', enc.encode(pass), { name: 'PBKDF2' }, false, ['deriveKey']);
                return crypto.subtle.deriveKey(
                    { name: 'PBKDF2', salt: enc.encode('tsb-secure-notes'), iterations: 100000, hash: 'SHA-256' },
                    keyMaterial,
                    { name: 'AES-GCM', length: 256 },
                    false,
                    ['encrypt', 'decrypt']
                );
            };
            secEncrypt?.addEventListener('click', async () => {
                const plain = secPlain?.value || '';
                const pass = secKey?.value || '';
                if (!plain || !pass) {
                    alert('Enter a note and passphrase first.');
                    return;
                }
                const iv = crypto.getRandomValues(new Uint8Array(12));
                const key = await deriveKey(pass);
                const encrypted = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, textToBytes(plain));
                const payload = `${bytesToBase64(iv)}:${bytesToBase64(new Uint8Array(encrypted))}`;
                if (secCipher) secCipher.value = payload;
            });
            secDecrypt?.addEventListener('click', async () => {
                const payload = secCipher?.value || '';
                const pass = secKey?.value || '';
                if (!payload || !pass) {
                    alert('Enter ciphertext and passphrase first.');
                    return;
                }
                const [ivB64, dataB64] = payload.split(':');
                if (!ivB64 || !dataB64) {
                    alert('Ciphertext format invalid.');
                    return;
                }
                const iv = base64ToBytes(ivB64);
                const data = base64ToBytes(dataB64);
                try {
                    const key = await deriveKey(pass);
                    const decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, data);
                    const text = new TextDecoder().decode(decrypted);
                    if (secPlain) secPlain.value = text;
                } catch (e) {
                    alert('Decryption failed. Check passphrase or data.');
                }
            });

            // EXIF/metadata stripper
            const exifInput = document.getElementById('exifInput');
            const exifStrip = document.getElementById('exifStrip');
            const exifInfo = document.getElementById('exifInfo');
            const exifDownload = document.getElementById('exifDownload');
            exifStrip?.addEventListener('click', () => {
                const file = exifInput?.files?.[0];
                if (!file) {
                    if (exifInfo) exifInfo.textContent = 'Choose an image first.';
                    return;
                }
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        canvas.toBlob((blob) => {
                            if (blob) {
                                const url = URL.createObjectURL(blob);
                                if (exifDownload) {
                                    exifDownload.href = url;
                                    exifDownload.style.display = 'inline-flex';
                                }
                                if (exifInfo) exifInfo.textContent = 'Metadata stripped. Download the cleaned image.';
                            }
                        }, 'image/jpeg', 0.92);
                    };
                    img.src = e.target?.result;
                };
                reader.readAsDataURL(file);
            });

            // Spell-check helper
            const spellArea = document.getElementById('spellArea');
            const spellCopy = document.getElementById('spellCopy');
            const spellClear = document.getElementById('spellClear');
            spellCopy?.addEventListener('click', async () => {
                const text = spellArea?.value || '';
                try {
                    await navigator.clipboard.writeText(text);
                    spellCopy.textContent = 'Copied';
                    setTimeout(() => (spellCopy.textContent = 'Copy text'), 1200);
                } catch (e) {
                    alert('Copy failed. You can copy manually:\n\n' + text);
                }
            });
            spellClear?.addEventListener('click', () => {
                if (spellArea) spellArea.value = '';
            });

            // URL safety checker (frontend heuristics only)
            const urlInput = document.getElementById('urlInput');
            const urlCheck = document.getElementById('urlCheck');
            const urlResult = document.getElementById('urlResult');
            const suspiciousTlds = new Set(['ru', 'cn', 'tk', 'ml', 'ga', 'cf', 'gq', 'work', 'zip', 'cam']);
            const looksLikeIp = (host) => /^(\d{1,3}\.){3}\d{1,3}$/.test(host);
            const hasPunycode = (host) => host.includes('xn--');
            const countDots = (host) => (host.match(/\./g) || []).length;
            const looksShortener = (host) => /(^|\.)bit\.ly$|(^|\.)tinyurl\.com$|(^|\.)t\.co$|(^|\.)goo\.gl$|(^|\.)ow\.ly$/.test(host);
            const checkUrl = (value) => {
                const findings = [];
                let parsed;
                try {
                    parsed = new URL(value);
                } catch {
                    findings.push({ level: 'red', text: 'Not a valid URL.' });
                    return findings;
                }
                const host = parsed.hostname.toLowerCase();
                const tld = host.split('.').pop() || '';
                if (parsed.protocol !== 'https:') findings.push({ level: 'yellow', text: 'Uses HTTP instead of HTTPS.' });
                if (looksLikeIp(host)) findings.push({ level: 'yellow', text: 'Uses a bare IP instead of a hostname.' });
                if (hasPunycode(host)) findings.push({ level: 'yellow', text: 'Hostname contains punycode (look-alike domain risk).' });
                if (countDots(host) >= 4) findings.push({ level: 'yellow', text: 'Many subdomains detected.' });
                if (suspiciousTlds.has(tld)) findings.push({ level: 'yellow', text: `TLD ${tld} is often abused; verify source.` });
                if (looksShortener(host)) findings.push({ level: 'yellow', text: 'Link shortener detected; destination hidden.' });
                if (parsed.username || parsed.password) findings.push({ level: 'red', text: 'URL contains embedded credentials (phishing risk).' });
                if (!findings.length) findings.push({ level: 'green', text: 'No obvious red flags found, but still proceed carefully.' });
                return findings;
            };
            const badgeFor = (level) => {
                const color = level === 'red' ? '#e74c3c' : level === 'yellow' ? '#f1c40f' : '#2ecc71';
                return `<span style="display:inline-flex;align-items:center;gap:8px;margin:2px 0;">
                    <span style="width:10px;height:10px;border-radius:50%;background:${color};flex-shrink:0;"></span>
                    <span>${level.toUpperCase()}</span>
                </span>`;
            };
            urlCheck?.addEventListener('click', () => {
                const val = urlInput?.value.trim();
                if (!val) {
                    urlResult.textContent = 'Enter a URL to check.';
                    return;
                }
                const res = checkUrl(val);
                urlResult.innerHTML = res.map((r) => `${badgeFor(r.level)} ${r.text}`).join('<br>');
            });

            const linkInput = document.getElementById('linkInput');
            const linkMake = document.getElementById('linkMake');
            const linkOutput = document.getElementById('linkOutput');
            const qrImage = document.getElementById('qrImage');
            const isValidUrl = (value) => {
                try { new URL(value); return true; } catch { return false; }
            };
            linkMake?.addEventListener('click', () => {
                const url = linkInput?.value.trim();
                if (!url || !isValidUrl(url)) {
                    linkOutput.textContent = 'Enter a valid URL (https://...)';
                    if (qrImage) qrImage.style.display = 'none';
                    return;
                }
                linkOutput.innerHTML = `Short link (placeholder): <a href="${url}" target="_blank" rel="noopener">${url}</a><br>QR generated below.`;
                if (qrImage) {
                    qrImage.src = `https://api.qrserver.com/v1/create-qr-code/?size=140x140&data=${encodeURIComponent(url)}`;
                    qrImage.style.display = 'block';
                }
            });

            const tzA = document.getElementById('tzA');
            const tzB = document.getElementById('tzB');
            const tzOutput = document.getElementById('tzOutput');
            const formatZone = (zone) => {
                try {
                    return new Intl.DateTimeFormat('en-US', {
                        timeZone: zone,
                        hour: '2-digit',
                        minute: '2-digit',
                        weekday: 'short',
                        month: 'short',
                        day: '2-digit'
                    }).format(new Date());
                } catch {
                    return null;
                }
            };
            const updateTZ = () => {
                const a = tzA?.value.trim();
                const b = tzB?.value.trim();
                const fa = a ? formatZone(a) : null;
                const fb = b ? formatZone(b) : null;
                if (fa && fb) {
                    tzOutput.textContent = `${a}: ${fa} | ${b}: ${fb}`;
                } else {
                    tzOutput.textContent = 'Enter IANA time zones (e.g., America/New_York, Europe/London).';
                }
            };
            tzA?.addEventListener('change', updateTZ);
            tzB?.addEventListener('change', updateTZ);

            const imageInput = document.getElementById('imageInput');
            const imageMax = document.getElementById('imageMax');
            const imageQuality = document.getElementById('imageQuality');
            const imageInfo = document.getElementById('imageInfo');
            const imageDownload = document.getElementById('imageDownload');
            const imageProcess = document.getElementById('imageProcess');
            imageProcess?.addEventListener('click', () => {
                const file = imageInput?.files?.[0];
                if (!file) {
                    imageInfo.textContent = 'Choose an image first.';
                    return;
                }
                const maxSide = Math.max(300, parseInt(imageMax?.value || '1280', 10));
                const quality = Math.min(1, Math.max(0.1, parseFloat(imageQuality?.value || '0.8')));
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let { width, height } = img;
                        if (width > height && width > maxSide) {
                            height = Math.round((height / width) * maxSide);
                            width = maxSide;
                        } else if (height > width && height > maxSide) {
                            width = Math.round((width / height) * maxSide);
                            height = maxSide;
                        }
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        canvas.toBlob(
                            (blob) => {
                                if (blob) {
                                    const url = URL.createObjectURL(blob);
                                    imageDownload.href = url;
                                    imageDownload.download = 'compressed.jpg';
                                    imageDownload.style.display = 'inline-flex';
                                    imageInfo.textContent = `Compressed to ${width}x${height} at quality ${quality}`;
                                }
                            },
                            'image/jpeg',
                            quality
                        );
                    };
                    img.src = e.target?.result;
                };
                reader.readAsDataURL(file);
            });
        })();
    </script>
</body>
</html>






